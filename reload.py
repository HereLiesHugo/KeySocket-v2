from subprocess import call
from time import sleep

print('Fetching all updates...')
call('git fetch --all', shell=True)
sleep(1)
print('Pulling latest changes...')
call('git pull', shell=True)
sleep(1)
print('Installing backend dependencies...')
call('npm install', shell=True)
sleep(1)
print('Auditing dependencies...')
call('npm audit', shell=True)
sleep(1)
print('Not Fixing dependencies in case of errors...')
sleep(1)
print('Reloading backend through pm2...')
call('pm2 reload keysocket --update-env', shell=True)
sleep(1)
print('Reloading nginx...')
call('sudo systemctl reload nginx', shell=True)
sleep(1)
print('Checking nginx status...')
sleep(1)
call('sudo systemctl status nginx', shell=True)
sleep(1)
print('Checking pm2 status...')
sleep(1)
call('pm2 status keysocket', shell=True)
sleep(1)
print('Update and reload complete!')
sleep(1)